name: Upgrade Golang

concurrency: Upgrade Golang 2

on:
  workflow_dispatch:
  # schedule:
  #   - cron: '0 0 * * 0'

jobs:
  upgrade-golang:
    runs-on: ubuntu-latest

    container:
      image: internalpcfplatformautomation/ci:testing

    defaults:
      run:
        shell: bash

    steps:
      - name: Checkout Om
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          path: om

      - name: Set up latest Go
        uses: actions/setup-go@v5
        with:
          check-latest: true

    # step 4: update go.mod and go.sum to use the new go version
      - id: upgrade-golang
        name: Upgrade Golang
        run: |
          version=$(go version | awk '{print $3}' | sed 's/go//')
          echo "Current go version: $version"
        # go mod edit -go=${{ steps.setup-go.outputs.go-version }}
        # go get -u -t ./...
        # go mod tidy
          

      # step 5: commit the changes and create a PR
      # - id: commit-changes-and-create-pr
      #   name: Commit changes and create PR
      #   run: |
      #     cd smoke-tests
      #     files_changed=$(git status --porcelain)
      #     if [[ -n ${files_changed} ]]; then
      #       git config --global url.https://${GITHUB_TOKEN}@github.com/.insteadOf https://github.com/
      #       git config --global user.email "149723437+tas-operability-bot@users.noreply.github.com"
      #       git config --global user.name "tas-operability-bot"

      #       branch_suffix=$(echo "${GITHUB_SHA}" | cut -c1-7)
      #       git checkout -b tmp/upgrade-golang-${branch_suffix}
      #       git add .
      #       git commit -m "Upgrade Golang"
      #       git push --set-upstream origin tmp/upgrade-golang-${branch_suffix}
      #       gh pr create --title "Upgrade Golang" --body "Upgrade Golang" --base main --head tmp/upgrade-golang-${branch_suffix}
      #       gh pr merge tmp/upgrade-golang-${branch_suffix} --auto --rebase --delete-branch
      #     fi
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.TAS_OPERABILITY_BOT_GH_PAT }}
